<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Google Sheets Picker - Admin</title>
    <style>
        body {
            background: #f5f7fa;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
    </style>
</head>

<body style="color: lightgrey;" onload="showPicker()">
    <!-- <div class="container">
        <h2 style="color: navy;">RingCentral App Connect - Admin</h2>
        <button onclick="showPicker()">Select Google Sheet</button>
        <div class="ringcentral-branding">
            Powered by <a href="https://www.ringcentral.com/" target="_blank">RingCentral</a>
        </div>
    </div> -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
        // Replace with your actual API key and OAuth token
        
        const key = '{key}';
        const ACCESS_TOKEN = '{accessToken}';
        const project_id = '{projectId}';
        const RC_ACCESS_TOKEN = '{rcAccessToken}';

        let pickerApiLoaded = false;

        // Load the Picker API
        function loadPicker() {
            gapi.load('picker', { 'callback': onPickerApiLoad });
        }

        function onPickerApiLoad() {
            pickerApiLoaded = true;
        }

        function showPicker() {
            if (pickerApiLoaded) {
                const view = new google.picker.View(google.picker.ViewId.SPREADSHEETS);
                // view.setMimeTypes('application/pdf,image/jpeg,image/png');
                view.setMimeTypes('application/vnd.google-apps.spreadsheet');


                const picker = new google.picker.PickerBuilder()
                    .addView(view)
                    .setOAuthToken(ACCESS_TOKEN)
                    .setAppId(project_id)
                    .setDeveloperKey(key)
                    .setCallback(pickerCallback)
                    .setTitle("Select a Google Sheet for Organization")
                    .build();

                picker.setVisible(true);
            } else {
                alert("Picker API not loaded yet. Please try again.");
            }
        }

       async function pickerCallback(data) {    
            if (data.action === google.picker.Action.PICKED) {
                const field = data.docs[0].id;
                await axios.post('{serverUrl}/admin/googleSheets/selectedSheet?rcAccessToken=' + RC_ACCESS_TOKEN, {
                    accessToken: ACCESS_TOKEN,
                    sheetData: data.docs[0],
                    customizable: false // Default to non-customizable, admin can change this in UI
                });
            }
            alert('You have successfully configured Google Sheets for your organization.\nFile Name: ' + data.docs[0].name + ' \nPlease return to Admin Settings to configure user permissions.');
           window.close();
        }
    </script>

    <!-- Load the Google Picker API -->
    <script type="text/javascript" src="https://apis.google.com/js/api.js?onload=loadPicker"></script>
    <script type="text/javascript" src="https://apis.google.com/js/client.js"></script>
</body>

</html>
